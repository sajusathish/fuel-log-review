<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Daily Fuel Log Review</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f4f7fa;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #007bff;
    margin-bottom: 15px;
  }
  #content {
    max-width: 900px;
    margin: 0 auto 30px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 7px rgba(0,0,0,0.1);
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 25px;
  }
  table, th, td {
    border: 1px solid #ddd;
  }
  th, td {
    padding: 10px;
    text-align: center;
  }
  th {
    background-color: #007bff;
    color: white;
  }
  button {
    background-color: #007bff;
    color: white;
    font-weight: bold;
    padding: 12px 25px;
    margin: 0 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button.reject {
    background-color: #dc3545;
  }
  button:hover {
    opacity: 0.85;
  }
  #buttons {
    text-align: center;
  }
</style>
</head>
<body>

<h1 id="page-title">Daily Fuel Log Review</h1>

<div id="content">
  Loading data...
</div>

<div id="buttons" style="display:none;">
  <button id="approve-btn">Approve</button>
  <button id="reject-btn" class="reject">Reject</button>
</div>

<script>
// Function to decode URL-safe Base64 and UTF-8 decode
function base64UrlDecodeToString(base64UrlString) {
  try {
    // Replace URL-safe chars with standard Base64 chars
    let base64 = base64UrlString.replace(/-/g, '+').replace(/_/g, '/');
    // Pad with '=' to multiple of 4
    while (base64.length % 4) {
      base64 += '=';
    }
    // Decode Base64 string to byte string
    let binaryString = atob(base64);
    // Convert byte string to UTF-8 string
    // Percent encode each byte for decodeURIComponent
    let utf8String = decodeURIComponent(
      binaryString.split('').map(c =>
        '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
      ).join('')
    );
    return utf8String;
  } catch (e) {
    console.error("Decode error:", e);
    return null;
  }
}

// Extract 'data' param from URL
function getQueryParam(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

// Add current date suffix to page title
function addDateToTitle() {
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, '0');
  const dd = String(today.getDate()).padStart(2, '0');
  const dateStr = `${yyyy}-${mm}-${dd}`;
  const title = document.getElementById('page-title');
  title.textContent = `Daily Fuel Log Review - ${dateStr}`;
}

// Main execution
(function() {
  addDateToTitle();

  const dataParam = getQueryParam('data');
  const contentDiv = document.getElementById('content');
  const buttonsDiv = document.getElementById('buttons');

  if (!dataParam) {
    contentDiv.textContent = "Error: No data provided.";
    return;
  }

  const decodedHtml = base64UrlDecodeToString(dataParam);

  if (!decodedHtml) {
    contentDiv.textContent = "Error decoding table data.";
    return;
  }

  // Insert decoded HTML safely
  contentDiv.innerHTML = decodedHtml;

  // Show approve/reject buttons only if table is present
  if (contentDiv.querySelector('table')) {
    buttonsDiv.style.display = 'block';
  }

  // Add button event listeners
  document.getElementById('approve-btn').addEventListener('click', () => {
    alert('You clicked Approve. Implement your approval logic here.');
    // You can add code here to send approval data back to server or redirect
  });

  document.getElementById('reject-btn').addEventListener('click', () => {
    alert('You clicked Reject. Implement your rejection logic here.');
    // You can add code here to send rejection data back to server or redirect
  });
})();
</script>

</body>
</html>
